@model MusicStoreEntity.Order
@{
    ViewBag.Title = "Buy";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}

<h2>确认购买</h2>
@using (Html.BeginForm())
{
    <fieldset>
        <legend>收件信息</legend>
        @Html.EditorForModel()
        <legend>您想购买的专辑列表</legend>
        <table id="tbCart1">
            <tr>
                <td>专辑名</td>
                <td>单价</td>
                <td>数量</td>
                <td>操作</td>
            </tr>
            <tbody  id="tbCart">
            @foreach (var item in Model.OrderDetails)
            {
                <tr>
                    <td>@Html.ActionLink(item.Album.Title,"detail","Store",new {id=item.Album.ID},null)</td>
                    <td>@item.Album.Price.ToString("C")</td>
                    <td> @item.Count </td>
                    <td><a href="#" onclick="removeDetail('@item.ID');">
                        <i class="glyphicon glyphicon-remove">
                            移除购物车
                        </i>
                    </a></td>
                </tr>
            }
            <tr>
                <td></td>
                <td></td>
                <td>总价</td>
                <td>@Model.TotalPrice.ToString("C")</td>
            </tr>
            </tbody>
        </table>
        <p>
            <button type="submit" class="btn btn-success"><i class="glyphicon glyphicon-shopping-cart"></i>确定购买</button>
        </p>
    </fieldset>
}
<script>
    function removeDetail(id) {
        //移除订单明细
        $.ajax({
            type: "post",
            async: true,
            url: "../../Order/RemoveDetail",
            data: { id: id},
            dataType: 'json',
            success: function (data) {
                //视图中tbody进行局部页面的刷新，<tbody>
                $("#tbCart").html(data);
            }
        });
    }
</script>
